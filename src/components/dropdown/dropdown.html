<div class="m-dropdown"
     :class="{ 'm--is-disabled': disabled, 'm--is-waiting': waiting, 'm--is-filterable': filterable }"
     :style="{ width: width, 'max-width': maxWidth }"
     @mousedown="onMousedown"
     @mouseup="onMouseup"
     ref="mDropdown">
    <m-popup :placement="bottom-start"
             :disabled="inactive"
             :open="open"
             :enter="transitionEnter"
             :leave="transitionLeave"
             :padding-header="false"
             :padding-body="false"
             :focus-management="false"
             width="100%"
             ref="popper"
             @open="onOpen"
             @close="open = false"
             :desktop-only="true">
        <div slot="header" v-show="isMqMaxS" :aria-hidden="!isMqMaxS">
            <h2 class="m-dropdown__header__label" v-if="hasLabel">{{ label }}</h2>
            <div class="m-dropdown__header__research" v-if="filterable">
                <input class="m-dropdown__header__research-input"
                       type="text"
                       placeholder="Recherche"
                       ref="researchInput"
                       v-model="selectedText">
                <m-button class="m-dropdown__header__research-button" mode="icon" icon-name="search">
                    <m-i18n k="m-dropdown:research"></m-i18n>
                </m-button>
            </div>
        </div>
        <ul class="m-dropdown__list" ref="listItems" slot="body" :style="{ 'max-height': propMaxHeightList + 'px' }">
            <slot></slot>
            <m-dropdown-item v-if="!hasItems && !dirty">{{ propTextNoData }}</m-dropdown-item>
            <m-dropdown-item v-if="!hasItems && dirty">{{ propTextNoMatch }}</m-dropdown-item>
        </ul>
        <m-input-style ref="mDropdownValue"
                      :label="label"
                      :state="propState"
                      :focus="open"
                      :empty="isEmpty"
                      :disabled="disabled"
                      :waiting="waiting">
            <input type="text"
                   ref="input"
                   class="m-dropdown__input"
                   :disabled="inactive"
                   :readonly="!filterable"
                   :placeholder="placeholder"
                   @keydown.enter.prevent="onKeydownEnter($event)"
                   @keydown.return.prevent="onKeydownEnter($event)"
                   @keydown.esc.prevent="onKeydownEscape($event)"
                   @keydown.up.prevent="onKeydownUp($event)"
                   @keydown.down.prevent="onKeydownDown($event)"
                   @keydown="onKeydown"
                   @focus="onFocus"
                   @blur="onBlur"
                   v-model="selectedText">
            <div slot="right-content" class="m-dropdown__arrow" :class="{ 'm--is-open': open }">
                <m-button mode="icon" icon-name="dropdown-arrow" @keydown.enter.prevent="arrowOnKeydownEnter">
                    <m-i18n k="m-dropdown:openDropdown" v-if="!open"></m-i18n>
                    <m-i18n k="m-dropdown:closeDropdown" v-if="open"></m-i18n>
                </m-button>
            </div>
        </m-input-style>
        <template slot="footer" v-if="hasFooterSlot">
            <slot name="footer"></slot>
        </template>
    </m-popup>
    <m-validation-message :error-message="errorMessage"
                          :valid-message="validMessage"
                          :helper-message="helperMessage"
                          v-if="!isDisabled"></m-validation-message>
</div>
